<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.health.mapper.UserMapper" >

	<select id="userList" resultType="User">
		SELECT 
		    u.userNo, 
		    u.userName, 
		    u.phone1, 
		    u.phone2, 
		    u.phone3, 
		    u.possessNum, 
		    e.employeeName, 
		    pt.ptPossessNum
		FROM 
			user u
		LEFT JOIN 
			pt ON u.userNo = pt.FK_pt_user
		LEFT JOIN 
			employee e ON pt.FK_pt_employee = e.employeeNo
		ORDER BY u.userNo DESC;
	</select>
	
	<select id="getUser" resultType="User" >
		SELECT
		    u.userNo,
		    u.userName,
		    u.age,
		    u.phone1, u.phone2, u.phone3,
		    u.regDate,
		    u.possessNum,
		    e.employeeName,
		    r.regPoint,
		    pt.ptPossessNum,
		    l.lockerRegDate,
		    l.lockerNo,
		    l.lockerDdate
		FROM
		    user u
		LEFT JOIN
		    locker l ON u.FK_user_locker = l.lockerNo
		LEFT JOIN
		    pt ON u.userNo = pt.FK_pt_user
		LEFT JOIN    
		    employee e ON pt.FK_pt_employee = e.employeeNo
		LEFT JOIN
		    regInfo r ON u.userNo = r.FK_regInfo_user
		WHERE userNo = #{no};
	</select>
	
	<select id="getUserRegdata" resultType="RegInfo" >
		SELECT
		    *
		FROM
		regInfo 
		WHERE FK_regInfo_user = #{no};
	</select>
	
	
	
	<update id="updateUser" parameterType="User">
		UPDATE user
			SET userName=#{userName}, age=#{age}, phone1=#{phone1},
			phone2=#{phone2}, phone3=#{phone3}, FK_user_locker=#{FK_user_locker}
		WHERE userNo = #{userNo}
	</update>
	
	<update id="updatePt" parameterType="Pt">
		UPDATE pt
		SET FK_pt_employee = (
		    SELECT employeeNo 
		    FROM employee 
		    WHERE employeeName = #{employeeName}
		)
		WHERE FK_pt_user = #{userNo};
	</update>
	
	<update id="updateLocker" parameterType="Locker">
		UPDATE locker 
		SET lockerRegDate= #{lockerRegDate}, lockerDdate = #{lockerDdate}
		WHERE lockerNo=#{lockerNo}
	</update>
</mapper>	



